---
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/Footer.astro';

const allPosts = await Astro.glob('../blog/*.{md,mdx}');

const posts = allPosts.sort((a, b) => {
  return new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf();
});

const postsByYear = posts.reduce((acc, post) => {
  const year = new Date(post.frontmatter.date).getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).sort().reverse();
---

<Layout title="Writing â€” Sambulo Senda">
  <main>
    <section class="pt-36 pb-20 sm:pt-44">
      <div class="max-w-2xl mx-auto px-4 sm:px-6">

        <header class="mb-12">
          <h1 class="text-2xl sm:text-3xl font-bold text-ink tracking-tight mb-3">Writing</h1>
          <p class="text-ink-muted">
            Thoughts and tutorials about mobile development and React Native.
          </p>
        </header>

        <!-- Featured latest post -->
        {posts[0] && (
          <a href={posts[0].url} class="group block bg-surface rounded-xl border border-border p-6 mb-12 hover:border-ink-faint/40 hover:shadow-sm transition-all">
            <span class="inline-block text-xs font-medium text-ink-faint mb-3">Latest</span>
            <h3 class="text-lg font-semibold text-ink group-hover:text-accent transition-colors mb-2">
              {posts[0].frontmatter.title}
            </h3>
            {posts[0].frontmatter.description && (
              <p class="text-ink-muted mb-3">{posts[0].frontmatter.description}</p>
            )}
            <div class="flex items-center gap-3 text-xs text-ink-faint font-mono">
              <time datetime={posts[0].frontmatter.date}>
                {new Date(posts[0].frontmatter.date).toLocaleDateString('en-US', {
                  month: 'short',
                  day: 'numeric',
                  year: 'numeric'
                })}
              </time>
              {posts[0].frontmatter.readingTime && (
                <>
                  <span class="text-border">&middot;</span>
                  <span>{posts[0].frontmatter.readingTime}</span>
                </>
              )}
            </div>
          </a>
        )}

        <!-- Posts by year -->
        <div class="space-y-10">
          {years.map(year => (
            <section>
              <h2 class="text-sm font-semibold text-ink-faint uppercase tracking-wider mb-4">{year}</h2>
              <div class="space-y-1">
                {postsByYear[year].map(post => (
                  <a href={post.url} class="group flex items-center justify-between gap-4 py-3 px-3 -mx-3 rounded-lg hover:bg-surface transition-colors">
                    <div class="flex-1 min-w-0">
                      <h3 class="text-sm font-medium text-ink group-hover:text-accent transition-colors truncate">
                        {post.frontmatter.title}
                      </h3>
                      {post.frontmatter.description && (
                        <p class="text-sm text-ink-faint mt-0.5 line-clamp-1">{post.frontmatter.description}</p>
                      )}
                    </div>
                    <time datetime={post.frontmatter.date} class="text-xs text-ink-faint whitespace-nowrap shrink-0 font-mono">
                      {new Date(post.frontmatter.date).toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                      })}
                    </time>
                  </a>
                ))}
              </div>
            </section>
          ))}
        </div>

        {posts.length === 0 && (
          <div class="text-center py-16">
            <p class="text-ink-faint">No posts yet.</p>
          </div>
        )}

      </div>
    </section>

    <Footer />
  </main>
</Layout>
